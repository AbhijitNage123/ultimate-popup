{"version":3,"sources":["@wordpress/block-editor/src/components/block-list/block-invalid-warning.js"],"names":["BlockInvalidWarning","convertToHTML","convertToBlocks","convertToClassic","attemptBlockRecovery","block","hasHTMLBlock","compare","setCompare","onCompare","onCompareClose","hiddenActions","title","onClick","filter","Boolean","blockToBlocks","blockToClassic","content","originalContent","blockToHTML","HTML","recoverBlock","name","attributes","innerBlocks","select","clientId","blockEditorStore","getBlock","dispatch","replaceBlock"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { __, _x } from '@wordpress/i18n';\nimport { Button, Modal } from '@wordpress/components';\nimport { useState, useCallback, useMemo } from '@wordpress/element';\nimport { getBlockType, createBlock, rawHandler } from '@wordpress/blocks';\nimport { compose } from '@wordpress/compose';\nimport { withDispatch, withSelect } from '@wordpress/data';\n\n/**\n * Internal dependencies\n */\nimport Warning from '../warning';\nimport BlockCompare from '../block-compare';\nimport { store as blockEditorStore } from '../../store';\n\nexport function BlockInvalidWarning( {\n\tconvertToHTML,\n\tconvertToBlocks,\n\tconvertToClassic,\n\tattemptBlockRecovery,\n\tblock,\n} ) {\n\tconst hasHTMLBlock = !! getBlockType( 'core/html' );\n\tconst [ compare, setCompare ] = useState( false );\n\n\tconst onCompare = useCallback( () => setCompare( true ), [] );\n\tconst onCompareClose = useCallback( () => setCompare( false ), [] );\n\n\t// We memo the array here to prevent the children components from being updated unexpectedly\n\tconst hiddenActions = useMemo(\n\t\t() =>\n\t\t\t[\n\t\t\t\t{\n\t\t\t\t\t// translators: Button to fix block content\n\t\t\t\t\ttitle: _x( 'Resolve', 'imperative verb' ),\n\t\t\t\t\tonClick: onCompare,\n\t\t\t\t},\n\t\t\t\thasHTMLBlock && {\n\t\t\t\t\ttitle: __( 'Convert to HTML' ),\n\t\t\t\t\tonClick: convertToHTML,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttitle: __( 'Convert to Classic Block' ),\n\t\t\t\t\tonClick: convertToClassic,\n\t\t\t\t},\n\t\t\t].filter( Boolean ),\n\t\t[ onCompare, convertToHTML, convertToClassic ]\n\t);\n\n\treturn (\n\t\t<>\n\t\t\t<Warning\n\t\t\t\tactions={ [\n\t\t\t\t\t<Button\n\t\t\t\t\t\tkey=\"recover\"\n\t\t\t\t\t\tonClick={ attemptBlockRecovery }\n\t\t\t\t\t\tvariant=\"primary\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{ __( 'Attempt Block Recovery' ) }\n\t\t\t\t\t</Button>,\n\t\t\t\t] }\n\t\t\t\tsecondaryActions={ hiddenActions }\n\t\t\t>\n\t\t\t\t{ __( 'This block contains unexpected or invalid content.' ) }\n\t\t\t</Warning>\n\t\t\t{ compare && (\n\t\t\t\t<Modal\n\t\t\t\t\ttitle={\n\t\t\t\t\t\t// translators: Dialog title to fix block content\n\t\t\t\t\t\t__( 'Resolve Block' )\n\t\t\t\t\t}\n\t\t\t\t\tonRequestClose={ onCompareClose }\n\t\t\t\t\tclassName=\"block-editor-block-compare\"\n\t\t\t\t>\n\t\t\t\t\t<BlockCompare\n\t\t\t\t\t\tblock={ block }\n\t\t\t\t\t\tonKeep={ convertToHTML }\n\t\t\t\t\t\tonConvert={ convertToBlocks }\n\t\t\t\t\t\tconvertor={ blockToBlocks }\n\t\t\t\t\t\tconvertButtonText={ __( 'Convert to Blocks' ) }\n\t\t\t\t\t/>\n\t\t\t\t</Modal>\n\t\t\t) }\n\t\t</>\n\t);\n}\n\nconst blockToClassic = ( block ) =>\n\tcreateBlock( 'core/freeform', {\n\t\tcontent: block.originalContent,\n\t} );\nconst blockToHTML = ( block ) =>\n\tcreateBlock( 'core/html', {\n\t\tcontent: block.originalContent,\n\t} );\nconst blockToBlocks = ( block ) =>\n\trawHandler( {\n\t\tHTML: block.originalContent,\n\t} );\nconst recoverBlock = ( { name, attributes, innerBlocks } ) =>\n\tcreateBlock( name, attributes, innerBlocks );\n\nexport default compose( [\n\twithSelect( ( select, { clientId } ) => ( {\n\t\tblock: select( blockEditorStore ).getBlock( clientId ),\n\t} ) ),\n\twithDispatch( ( dispatch, { block } ) => {\n\t\tconst { replaceBlock } = dispatch( blockEditorStore );\n\n\t\treturn {\n\t\t\tconvertToClassic() {\n\t\t\t\treplaceBlock( block.clientId, blockToClassic( block ) );\n\t\t\t},\n\t\t\tconvertToHTML() {\n\t\t\t\treplaceBlock( block.clientId, blockToHTML( block ) );\n\t\t\t},\n\t\t\tconvertToBlocks() {\n\t\t\t\treplaceBlock( block.clientId, blockToBlocks( block ) );\n\t\t\t},\n\t\t\tattemptBlockRecovery() {\n\t\t\t\treplaceBlock( block.clientId, recoverBlock( block ) );\n\t\t\t},\n\t\t};\n\t} ),\n] )( BlockInvalidWarning );\n"]}