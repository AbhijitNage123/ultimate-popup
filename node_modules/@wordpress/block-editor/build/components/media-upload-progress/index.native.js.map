{"version":3,"sources":["@wordpress/block-editor/src/components/media-upload-progress/index.native.js"],"names":["MEDIA_UPLOAD_STATE_UPLOADING","MEDIA_UPLOAD_STATE_SUCCEEDED","MEDIA_UPLOAD_STATE_FAILED","MEDIA_UPLOAD_STATE_RESET","MediaUploadProgress","Component","constructor","props","state","progress","isUploadInProgress","isUploadFailed","mediaUpload","bind","componentDidMount","addMediaUploadListener","componentWillUnmount","removeMediaUploadListener","payload","mediaId","updateMediaProgress","finishMediaUploadWithSuccess","finishMediaUploadWithFailure","mediaUploadStateReset","setState","onUpdateMediaProgress","onFinishMediaUploadWithSuccess","onFinishMediaUploadWithFailure","onMediaUploadStateReset","subscriptionParentMediaUpload","remove","render","renderContent","showSpinner","retryMessage","progressBarStyle","styles","progressBar","progressBarHidden","mediaUploadProgress","containerStyle","spinnerStyle"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { View } from 'react-native';\n\n/**\n * WordPress dependencies\n */\nimport { Component } from '@wordpress/element';\nimport { Spinner } from '@wordpress/components';\nimport { __ } from '@wordpress/i18n';\nimport { subscribeMediaUpload } from '@wordpress/react-native-bridge';\n\n/**\n * Internal dependencies\n */\nimport styles from './styles.scss';\n\nexport const MEDIA_UPLOAD_STATE_UPLOADING = 1;\nexport const MEDIA_UPLOAD_STATE_SUCCEEDED = 2;\nexport const MEDIA_UPLOAD_STATE_FAILED = 3;\nexport const MEDIA_UPLOAD_STATE_RESET = 4;\n\nexport class MediaUploadProgress extends Component {\n\tconstructor( props ) {\n\t\tsuper( props );\n\n\t\tthis.state = {\n\t\t\tprogress: 0,\n\t\t\tisUploadInProgress: false,\n\t\t\tisUploadFailed: false,\n\t\t};\n\n\t\tthis.mediaUpload = this.mediaUpload.bind( this );\n\t}\n\n\tcomponentDidMount() {\n\t\tthis.addMediaUploadListener();\n\t}\n\n\tcomponentWillUnmount() {\n\t\tthis.removeMediaUploadListener();\n\t}\n\n\tmediaUpload( payload ) {\n\t\tconst { mediaId } = this.props;\n\n\t\tif ( payload.mediaId !== mediaId ) {\n\t\t\treturn;\n\t\t}\n\n\t\tswitch ( payload.state ) {\n\t\t\tcase MEDIA_UPLOAD_STATE_UPLOADING:\n\t\t\t\tthis.updateMediaProgress( payload );\n\t\t\t\tbreak;\n\t\t\tcase MEDIA_UPLOAD_STATE_SUCCEEDED:\n\t\t\t\tthis.finishMediaUploadWithSuccess( payload );\n\t\t\t\tbreak;\n\t\t\tcase MEDIA_UPLOAD_STATE_FAILED:\n\t\t\t\tthis.finishMediaUploadWithFailure( payload );\n\t\t\t\tbreak;\n\t\t\tcase MEDIA_UPLOAD_STATE_RESET:\n\t\t\t\tthis.mediaUploadStateReset( payload );\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tupdateMediaProgress( payload ) {\n\t\tthis.setState( {\n\t\t\tprogress: payload.progress,\n\t\t\tisUploadInProgress: true,\n\t\t\tisUploadFailed: false,\n\t\t} );\n\t\tif ( this.props.onUpdateMediaProgress ) {\n\t\t\tthis.props.onUpdateMediaProgress( payload );\n\t\t}\n\t}\n\n\tfinishMediaUploadWithSuccess( payload ) {\n\t\tthis.setState( { isUploadInProgress: false } );\n\t\tif ( this.props.onFinishMediaUploadWithSuccess ) {\n\t\t\tthis.props.onFinishMediaUploadWithSuccess( payload );\n\t\t}\n\t}\n\n\tfinishMediaUploadWithFailure( payload ) {\n\t\tthis.setState( { isUploadInProgress: false, isUploadFailed: true } );\n\t\tif ( this.props.onFinishMediaUploadWithFailure ) {\n\t\t\tthis.props.onFinishMediaUploadWithFailure( payload );\n\t\t}\n\t}\n\n\tmediaUploadStateReset( payload ) {\n\t\tthis.setState( { isUploadInProgress: false, isUploadFailed: false } );\n\t\tif ( this.props.onMediaUploadStateReset ) {\n\t\t\tthis.props.onMediaUploadStateReset( payload );\n\t\t}\n\t}\n\n\taddMediaUploadListener() {\n\t\t//if we already have a subscription not worth doing it again\n\t\tif ( this.subscriptionParentMediaUpload ) {\n\t\t\treturn;\n\t\t}\n\t\tthis.subscriptionParentMediaUpload = subscribeMediaUpload(\n\t\t\t( payload ) => {\n\t\t\t\tthis.mediaUpload( payload );\n\t\t\t}\n\t\t);\n\t}\n\n\tremoveMediaUploadListener() {\n\t\tif ( this.subscriptionParentMediaUpload ) {\n\t\t\tthis.subscriptionParentMediaUpload.remove();\n\t\t}\n\t}\n\n\trender() {\n\t\tconst { renderContent = () => null } = this.props;\n\t\tconst { isUploadInProgress, isUploadFailed } = this.state;\n\t\tconst showSpinner = this.state.isUploadInProgress;\n\t\tconst progress = this.state.progress * 100;\n\t\t// eslint-disable-next-line @wordpress/i18n-no-collapsible-whitespace\n\t\tconst retryMessage = __(\n\t\t\t'Failed to insert media.\\nPlease tap for options.'\n\t\t);\n\n\t\tconst progressBarStyle = [\n\t\t\tstyles.progressBar,\n\t\t\tshowSpinner || styles.progressBarHidden,\n\t\t\tthis.props.progressBarStyle,\n\t\t];\n\n\t\treturn (\n\t\t\t<View\n\t\t\t\tstyle={ [\n\t\t\t\t\tstyles.mediaUploadProgress,\n\t\t\t\t\tthis.props.containerStyle,\n\t\t\t\t] }\n\t\t\t\tpointerEvents=\"box-none\"\n\t\t\t>\n\t\t\t\t<View style={ progressBarStyle }>\n\t\t\t\t\t{ showSpinner && (\n\t\t\t\t\t\t<Spinner\n\t\t\t\t\t\t\tprogress={ progress }\n\t\t\t\t\t\t\tstyle={ this.props.spinnerStyle }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t</View>\n\t\t\t\t{ renderContent( {\n\t\t\t\t\tisUploadInProgress,\n\t\t\t\t\tisUploadFailed,\n\t\t\t\t\tretryMessage,\n\t\t\t\t} ) }\n\t\t\t</View>\n\t\t);\n\t}\n}\n\nexport default MediaUploadProgress;\n"]}