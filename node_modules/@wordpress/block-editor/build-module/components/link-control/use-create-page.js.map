{"version":3,"sources":["@wordpress/block-editor/src/components/link-control/use-create-page.js"],"names":["__","useEffect","useState","useRef","useCreatePage","handleCreatePage","cancelableCreateSuggestion","isCreatingPage","setIsCreatingPage","errorMessage","setErrorMessage","createPage","suggestionTitle","current","makeCancelable","Promise","resolve","promise","error","isCanceled","message","cancel","hasCanceled_","wrappedPromise","reject","then","val"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,EAAT,QAAmB,iBAAnB;AACA,SAASC,SAAT,EAAoBC,QAApB,EAA8BC,MAA9B,QAA4C,oBAA5C;AAEA,eAAe,SAASC,aAAT,CAAwBC,gBAAxB,EAA2C;AACzD,QAAMC,0BAA0B,GAAGH,MAAM,EAAzC;AACA,QAAM,CAAEI,cAAF,EAAkBC,iBAAlB,IAAwCN,QAAQ,CAAE,KAAF,CAAtD;AACA,QAAM,CAAEO,YAAF,EAAgBC,eAAhB,IAAoCR,QAAQ,CAAE,IAAF,CAAlD;;AAEA,QAAMS,UAAU,GAAG,gBAAiBC,eAAjB,EAAmC;AACrDJ,IAAAA,iBAAiB,CAAE,IAAF,CAAjB;AACAE,IAAAA,eAAe,CAAE,IAAF,CAAf;;AAEA,QAAI;AACH;AACA;AACAJ,MAAAA,0BAA0B,CAACO,OAA3B,GAAqCC,cAAc,EAClD;AACA;AACAC,MAAAA,OAAO,CAACC,OAAR,CAAiBX,gBAAgB,CAAEO,eAAF,CAAjC,CAHkD,CAAnD;AAMA,aAAO,MAAMN,0BAA0B,CAACO,OAA3B,CAAmCI,OAAhD;AACA,KAVD,CAUE,OAAQC,KAAR,EAAgB;AACjB,UAAKA,KAAK,IAAIA,KAAK,CAACC,UAApB,EAAiC;AAChC,eADgC,CACxB;AACR;;AAEDT,MAAAA,eAAe,CACdQ,KAAK,CAACE,OAAN,IACCpB,EAAE,CACD,8DADC,CAFW,CAAf;AAMA,YAAMkB,KAAN;AACA,KAtBD,SAsBU;AACTV,MAAAA,iBAAiB,CAAE,KAAF,CAAjB;AACA;AACD,GA7BD;AA+BA;AACD;AACA;;;AACCP,EAAAA,SAAS,CAAE,MAAM;AAChB,WAAO,MAAM;AACZ;AACA,UAAKK,0BAA0B,CAACO,OAAhC,EAA0C;AACzCP,QAAAA,0BAA0B,CAACO,OAA3B,CAAmCQ,MAAnC;AACA;AACD,KALD;AAMA,GAPQ,EAON,EAPM,CAAT;AASA,SAAO;AACNV,IAAAA,UADM;AAENJ,IAAAA,cAFM;AAGNE,IAAAA;AAHM,GAAP;AAKA;AAED;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,MAAMK,cAAc,GAAKG,OAAF,IAAe;AACrC,MAAIK,YAAY,GAAG,KAAnB;AAEA,QAAMC,cAAc,GAAG,IAAIR,OAAJ,CAAa,CAAEC,OAAF,EAAWQ,MAAX,KAAuB;AAC1DP,IAAAA,OAAO,CAACQ,IAAR,CACGC,GAAF,IACCJ,YAAY,GAAGE,MAAM,CAAE;AAAEL,MAAAA,UAAU,EAAE;AAAd,KAAF,CAAT,GAAoCH,OAAO,CAAEU,GAAF,CAFzD,EAGGR,KAAF,IACCI,YAAY,GAAGE,MAAM,CAAE;AAAEL,MAAAA,UAAU,EAAE;AAAd,KAAF,CAAT,GAAoCK,MAAM,CAAEN,KAAF,CAJxD;AAMA,GAPsB,CAAvB;AASA,SAAO;AACND,IAAAA,OAAO,EAAEM,cADH;;AAENF,IAAAA,MAAM,GAAG;AACRC,MAAAA,YAAY,GAAG,IAAf;AACA;;AAJK,GAAP;AAMA,CAlBD","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport { useEffect, useState, useRef } from '@wordpress/element';\n\nexport default function useCreatePage( handleCreatePage ) {\n\tconst cancelableCreateSuggestion = useRef();\n\tconst [ isCreatingPage, setIsCreatingPage ] = useState( false );\n\tconst [ errorMessage, setErrorMessage ] = useState( null );\n\n\tconst createPage = async function ( suggestionTitle ) {\n\t\tsetIsCreatingPage( true );\n\t\tsetErrorMessage( null );\n\n\t\ttry {\n\t\t\t// Make cancellable in order that we can avoid setting State\n\t\t\t// if the component unmounts during the call to `createSuggestion`\n\t\t\tcancelableCreateSuggestion.current = makeCancelable(\n\t\t\t\t// Using Promise.resolve to allow createSuggestion to return a\n\t\t\t\t// non-Promise based value.\n\t\t\t\tPromise.resolve( handleCreatePage( suggestionTitle ) )\n\t\t\t);\n\n\t\t\treturn await cancelableCreateSuggestion.current.promise;\n\t\t} catch ( error ) {\n\t\t\tif ( error && error.isCanceled ) {\n\t\t\t\treturn; // bail if canceled to avoid setting state\n\t\t\t}\n\n\t\t\tsetErrorMessage(\n\t\t\t\terror.message ||\n\t\t\t\t\t__(\n\t\t\t\t\t\t'An unknown error occurred during creation. Please try again.'\n\t\t\t\t\t)\n\t\t\t);\n\t\t\tthrow error;\n\t\t} finally {\n\t\t\tsetIsCreatingPage( false );\n\t\t}\n\t};\n\n\t/**\n\t * Handles cancelling any pending Promises that have been made cancelable.\n\t */\n\tuseEffect( () => {\n\t\treturn () => {\n\t\t\t// componentDidUnmount\n\t\t\tif ( cancelableCreateSuggestion.current ) {\n\t\t\t\tcancelableCreateSuggestion.current.cancel();\n\t\t\t}\n\t\t};\n\t}, [] );\n\n\treturn {\n\t\tcreatePage,\n\t\tisCreatingPage,\n\t\terrorMessage,\n\t};\n}\n\n/**\n * Creates a wrapper around a promise which allows it to be programmatically\n * cancelled.\n * See: https://reactjs.org/blog/2015/12/16/ismounted-antipattern.html\n *\n * @param {Promise} promise the Promise to make cancelable\n */\nconst makeCancelable = ( promise ) => {\n\tlet hasCanceled_ = false;\n\n\tconst wrappedPromise = new Promise( ( resolve, reject ) => {\n\t\tpromise.then(\n\t\t\t( val ) =>\n\t\t\t\thasCanceled_ ? reject( { isCanceled: true } ) : resolve( val ),\n\t\t\t( error ) =>\n\t\t\t\thasCanceled_ ? reject( { isCanceled: true } ) : reject( error )\n\t\t);\n\t} );\n\n\treturn {\n\t\tpromise: wrappedPromise,\n\t\tcancel() {\n\t\t\thasCanceled_ = true;\n\t\t},\n\t};\n};\n"]}