{"version":3,"sources":["@wordpress/block-editor/src/components/use-simulated-media-query/index.js"],"names":["filter","match","useEffect","getProtocol","getAuthority","ENABLED_MEDIA_QUERY","DISABLED_MEDIA_QUERY","VALID_MEDIA_QUERY_REGEX","getStyleSheetsThatMatchHostname","window","document","styleSheets","styleSheet","href","location","protocol","host","isReplaceableMediaRule","rule","media","mediaText","replaceRule","newRuleText","index","deleteRule","insertRule","replaceMediaQueryWithWidthEvaluation","ruleText","widthValue","replace","matchedSubstring","type","width","useSimulatedMediaQuery","marker","originalStyles","forEach","styleSheetIndex","relevantSection","ruleIndex","cssRules","length","CSSRule","STYLE_RULE","MEDIA_RULE","cssText","RegExp","rulesCollection","originalRuleText"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { filter } from 'lodash';\nimport { match } from 'css-mediaquery';\n\n/**\n * WordPress dependencies\n */\nimport { useEffect } from '@wordpress/element';\nimport { getProtocol, getAuthority } from '@wordpress/url';\n\nconst ENABLED_MEDIA_QUERY = '(min-width:0px)';\nconst DISABLED_MEDIA_QUERY = '(min-width:999999px)';\n\nconst VALID_MEDIA_QUERY_REGEX = /\\((min|max)-width:[^\\(]*?\\)/g;\n\nfunction getStyleSheetsThatMatchHostname() {\n\tif ( typeof window === 'undefined' ) {\n\t\treturn [];\n\t}\n\n\treturn filter( window?.document?.styleSheets ?? [], ( styleSheet ) => {\n\t\tif ( ! styleSheet.href ) {\n\t\t\treturn false;\n\t\t}\n\t\treturn (\n\t\t\tgetProtocol( styleSheet.href ) === window.location.protocol &&\n\t\t\tgetAuthority( styleSheet.href ) === window.location.host\n\t\t);\n\t} );\n}\n\nfunction isReplaceableMediaRule( rule ) {\n\tif ( ! rule.media ) {\n\t\treturn false;\n\t}\n\t// Need to use \"media.mediaText\" instead of \"conditionText\" for IE support.\n\treturn !! rule.media.mediaText.match( VALID_MEDIA_QUERY_REGEX );\n}\n\nfunction replaceRule( styleSheet, newRuleText, index ) {\n\tstyleSheet.deleteRule( index );\n\tstyleSheet.insertRule( newRuleText, index );\n}\n\nfunction replaceMediaQueryWithWidthEvaluation( ruleText, widthValue ) {\n\treturn ruleText.replace( VALID_MEDIA_QUERY_REGEX, ( matchedSubstring ) => {\n\t\tif (\n\t\t\tmatch( matchedSubstring, {\n\t\t\t\ttype: 'screen',\n\t\t\t\twidth: widthValue,\n\t\t\t} )\n\t\t) {\n\t\t\treturn ENABLED_MEDIA_QUERY;\n\t\t}\n\t\treturn DISABLED_MEDIA_QUERY;\n\t} );\n}\n\n/**\n * Function that manipulates media queries from stylesheets to simulate a given\n * viewport width.\n *\n * @param {string}  marker CSS selector string defining start and end of\n *                         manipulable styles.\n * @param {number?} width  Viewport width to simulate. If provided null, the\n *                         stylesheets will not be modified.\n */\nexport default function useSimulatedMediaQuery( marker, width ) {\n\tuseEffect( () => {\n\t\tif ( ! width ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst styleSheets = getStyleSheetsThatMatchHostname();\n\t\tconst originalStyles = [];\n\t\tstyleSheets.forEach( ( styleSheet, styleSheetIndex ) => {\n\t\t\tlet relevantSection = false;\n\t\t\tfor (\n\t\t\t\tlet ruleIndex = 0;\n\t\t\t\truleIndex < styleSheet.cssRules.length;\n\t\t\t\t++ruleIndex\n\t\t\t) {\n\t\t\t\tconst rule = styleSheet.cssRules[ ruleIndex ];\n\t\t\t\tif (\n\t\t\t\t\trule.type !== window.CSSRule.STYLE_RULE &&\n\t\t\t\t\trule.type !== window.CSSRule.MEDIA_RULE\n\t\t\t\t) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (\n\t\t\t\t\t! relevantSection &&\n\t\t\t\t\t!! rule.cssText.match( new RegExp( `#start-${ marker }` ) )\n\t\t\t\t) {\n\t\t\t\t\trelevantSection = true;\n\t\t\t\t}\n\n\t\t\t\tif (\n\t\t\t\t\trelevantSection &&\n\t\t\t\t\t!! rule.cssText.match( new RegExp( `#end-${ marker }` ) )\n\t\t\t\t) {\n\t\t\t\t\trelevantSection = false;\n\t\t\t\t}\n\n\t\t\t\tif ( ! relevantSection || ! isReplaceableMediaRule( rule ) ) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tconst ruleText = rule.cssText;\n\t\t\t\tif ( ! originalStyles[ styleSheetIndex ] ) {\n\t\t\t\t\toriginalStyles[ styleSheetIndex ] = [];\n\t\t\t\t}\n\t\t\t\toriginalStyles[ styleSheetIndex ][ ruleIndex ] = ruleText;\n\t\t\t\treplaceRule(\n\t\t\t\t\tstyleSheet,\n\t\t\t\t\treplaceMediaQueryWithWidthEvaluation( ruleText, width ),\n\t\t\t\t\truleIndex\n\t\t\t\t);\n\t\t\t}\n\t\t} );\n\t\treturn () => {\n\t\t\toriginalStyles.forEach( ( rulesCollection, styleSheetIndex ) => {\n\t\t\t\tif ( ! rulesCollection ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tfor (\n\t\t\t\t\tlet ruleIndex = 0;\n\t\t\t\t\truleIndex < rulesCollection.length;\n\t\t\t\t\t++ruleIndex\n\t\t\t\t) {\n\t\t\t\t\tconst originalRuleText = rulesCollection[ ruleIndex ];\n\t\t\t\t\tif ( originalRuleText ) {\n\t\t\t\t\t\treplaceRule(\n\t\t\t\t\t\t\tstyleSheets[ styleSheetIndex ],\n\t\t\t\t\t\t\toriginalRuleText,\n\t\t\t\t\t\t\truleIndex\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} );\n\t\t};\n\t}, [ width ] );\n}\n"]}