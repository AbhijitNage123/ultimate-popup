{"version":3,"sources":["@wordpress/block-editor/src/components/inserter/menu.native.js"],"names":["AccessibilityInfo","LayoutAnimation","TouchableHighlight","Platform","useEffect","useState","useCallback","useSelect","useDispatch","createBlock","BottomSheet","BottomSheetConsumer","SearchControl","InserterSearchResults","store","blockEditorStore","InserterTabs","styles","MIN_ITEMS_FOR_SEARCH","REUSABLE_BLOCKS_CATEGORY","InserterMenu","onSelect","onDismiss","rootClientId","clientId","isAppender","shouldReplaceBlock","insertionIndex","filterValue","setFilterValue","showTabs","setShowTabs","showSearchForm","setShowSearchForm","__DEV__","tabIndex","setTabIndex","showInsertionPoint","hideInsertionPoint","clearSelectedBlock","insertBlock","removeBlock","resetBlocks","insertDefaultBlock","items","destinationRootClientId","showReusableBlocks","select","getInserterItems","getBlockRootClientId","getBlockSelectionEnd","targetRootClientId","end","undefined","allItems","reusableBlockItems","filter","category","length","getBlockOrder","getBlockCount","count","blockToReplace","onClose","onInsert","item","name","initialAttributes","innerBlocks","newBlock","source","onSelectItem","OS","isScreenReaderEnabled","then","enabled","timeout","setTimeout","onChangeSearch","value","configureNext","Presets","easeInEaseOut","onKeyboardShow","onKeyboardHide","list","listProps"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport {\n\tAccessibilityInfo,\n\tLayoutAnimation,\n\tTouchableHighlight,\n\tPlatform,\n} from 'react-native';\n\n/**\n * WordPress dependencies\n */\nimport { useEffect, useState, useCallback } from '@wordpress/element';\nimport { useSelect, useDispatch } from '@wordpress/data';\nimport { createBlock } from '@wordpress/blocks';\nimport {\n\tBottomSheet,\n\tBottomSheetConsumer,\n\tSearchControl,\n} from '@wordpress/components';\n\n/**\n * Internal dependencies\n */\nimport InserterSearchResults from './search-results';\nimport { store as blockEditorStore } from '../../store';\nimport InserterTabs from './tabs';\nimport styles from './style.scss';\n\nconst MIN_ITEMS_FOR_SEARCH = 2;\nconst REUSABLE_BLOCKS_CATEGORY = 'reusable';\n\nfunction InserterMenu( {\n\tonSelect,\n\tonDismiss,\n\trootClientId,\n\tclientId,\n\tisAppender,\n\tshouldReplaceBlock,\n\tinsertionIndex,\n} ) {\n\tconst [ filterValue, setFilterValue ] = useState( '' );\n\tconst [ showTabs, setShowTabs ] = useState( true );\n\t// eslint-disable-next-line no-undef\n\tconst [ showSearchForm, setShowSearchForm ] = useState( __DEV__ );\n\tconst [ tabIndex, setTabIndex ] = useState( 0 );\n\n\tconst {\n\t\tshowInsertionPoint,\n\t\thideInsertionPoint,\n\t\tclearSelectedBlock,\n\t\tinsertBlock,\n\t\tremoveBlock,\n\t\tresetBlocks,\n\t\tinsertDefaultBlock,\n\t} = useDispatch( blockEditorStore );\n\n\tconst { items, destinationRootClientId, showReusableBlocks } = useSelect(\n\t\t( select ) => {\n\t\t\tconst {\n\t\t\t\tgetInserterItems,\n\t\t\t\tgetBlockRootClientId,\n\t\t\t\tgetBlockSelectionEnd,\n\t\t\t} = select( blockEditorStore );\n\n\t\t\tlet targetRootClientId = rootClientId;\n\t\t\tif ( ! targetRootClientId && ! clientId && ! isAppender ) {\n\t\t\t\tconst end = getBlockSelectionEnd();\n\t\t\t\tif ( end ) {\n\t\t\t\t\ttargetRootClientId =\n\t\t\t\t\t\tgetBlockRootClientId( end ) || undefined;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst allItems = getInserterItems( targetRootClientId );\n\t\t\tconst reusableBlockItems = allItems.filter(\n\t\t\t\t( { category } ) => category === REUSABLE_BLOCKS_CATEGORY\n\t\t\t);\n\n\t\t\treturn {\n\t\t\t\titems: allItems,\n\t\t\t\tdestinationRootClientId: targetRootClientId,\n\t\t\t\tshowReusableBlocks: !! reusableBlockItems.length,\n\t\t\t};\n\t\t}\n\t);\n\n\tconst { getBlockOrder, getBlockCount } = useSelect( blockEditorStore );\n\n\tuseEffect( () => {\n\t\t// Show/Hide insertion point on Mount/Dismount\n\t\tif ( shouldReplaceBlock ) {\n\t\t\tconst count = getBlockCount();\n\t\t\t// Check if there is a rootClientId because that means it is a nested replaceable block\n\t\t\t// and we don't want to clear/reset all blocks.\n\t\t\tif ( count === 1 && ! rootClientId ) {\n\t\t\t\t// Removing the last block is not possilble with `removeBlock` action.\n\t\t\t\t// It always inserts a default block if the last of the blocks have been removed.\n\t\t\t\tclearSelectedBlock();\n\t\t\t\tresetBlocks( [] );\n\t\t\t} else {\n\t\t\t\tconst blockToReplace = getBlockOrder( destinationRootClientId )[\n\t\t\t\t\tinsertionIndex\n\t\t\t\t];\n\t\t\t\tremoveBlock( blockToReplace, false );\n\t\t\t}\n\t\t}\n\t\tshowInsertionPoint( destinationRootClientId, insertionIndex );\n\n\t\t// Show search form if there are enough items to filter.\n\t\tif ( items.length < MIN_ITEMS_FOR_SEARCH ) {\n\t\t\tsetShowSearchForm( false );\n\t\t}\n\n\t\treturn hideInsertionPoint;\n\t}, [] );\n\n\tconst onClose = useCallback( () => {\n\t\t// if should replace but didn't insert any block\n\t\t// re-insert default block\n\t\tif ( shouldReplaceBlock ) {\n\t\t\tinsertDefaultBlock( {}, destinationRootClientId, insertionIndex );\n\t\t}\n\t\tonDismiss();\n\t}, [ shouldReplaceBlock, destinationRootClientId, insertionIndex ] );\n\n\tconst onInsert = useCallback(\n\t\t( item ) => {\n\t\t\tconst { name, initialAttributes, innerBlocks } = item;\n\n\t\t\tconst newBlock = createBlock(\n\t\t\t\tname,\n\t\t\t\tinitialAttributes,\n\t\t\t\tinnerBlocks\n\t\t\t);\n\n\t\t\tinsertBlock(\n\t\t\t\tnewBlock,\n\t\t\t\tinsertionIndex,\n\t\t\t\tdestinationRootClientId,\n\t\t\t\ttrue,\n\t\t\t\t{ source: 'inserter_menu' }\n\t\t\t);\n\t\t},\n\t\t[ insertBlock, destinationRootClientId, insertionIndex ]\n\t);\n\n\tconst onSelectItem = useCallback(\n\t\t( item ) => {\n\t\t\t// Avoid a focus loop, see https://github.com/WordPress/gutenberg/issues/30562\n\t\t\tif ( Platform.OS === 'ios' ) {\n\t\t\t\tAccessibilityInfo.isScreenReaderEnabled().then( ( enabled ) => {\n\t\t\t\t\t// In testing, the bug focus loop needed a longer timeout when VoiceOver was enabled\n\t\t\t\t\tconst timeout = enabled ? 200 : 100;\n\t\t\t\t\t// eslint-disable-next-line @wordpress/react-no-unsafe-timeout\n\t\t\t\t\tsetTimeout( () => {\n\t\t\t\t\t\tonInsert( item );\n\t\t\t\t\t}, timeout );\n\t\t\t\t} );\n\t\t\t} else {\n\t\t\t\tonInsert( item );\n\t\t\t}\n\t\t\tonSelect( item );\n\t\t},\n\t\t[ onInsert, onSelect ]\n\t);\n\n\tconst onChangeSearch = useCallback(\n\t\t( value ) => {\n\t\t\tif ( ! value ) {\n\t\t\t\tLayoutAnimation.configureNext(\n\t\t\t\t\tLayoutAnimation.Presets.easeInEaseOut\n\t\t\t\t);\n\t\t\t}\n\t\t\tsetFilterValue( value );\n\t\t},\n\t\t[ setFilterValue ]\n\t);\n\n\tconst onKeyboardShow = useCallback( () => setShowTabs( false ), [\n\t\tsetShowTabs,\n\t] );\n\n\tconst onKeyboardHide = useCallback( () => setShowTabs( true ), [\n\t\tsetShowTabs,\n\t] );\n\n\treturn (\n\t\t<BottomSheet\n\t\t\tisVisible={ true }\n\t\t\tonClose={ onClose }\n\t\t\tonKeyboardShow={ onKeyboardShow }\n\t\t\tonKeyboardHide={ onKeyboardHide }\n\t\t\theader={\n\t\t\t\t<>\n\t\t\t\t\t{ showSearchForm && (\n\t\t\t\t\t\t<SearchControl\n\t\t\t\t\t\t\tonChange={ onChangeSearch }\n\t\t\t\t\t\t\tvalue={ filterValue }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t\t{ showTabs && ! filterValue && (\n\t\t\t\t\t\t<InserterTabs.Control\n\t\t\t\t\t\t\tonChangeTab={ setTabIndex }\n\t\t\t\t\t\t\tshowReusableBlocks={ showReusableBlocks }\n\t\t\t\t\t\t/>\n\t\t\t\t\t) }\n\t\t\t\t</>\n\t\t\t}\n\t\t\thasNavigation\n\t\t\tsetMinHeightToMaxHeight={ showSearchForm }\n\t\t\tcontentStyle={ styles.list }\n\t\t>\n\t\t\t<BottomSheetConsumer>\n\t\t\t\t{ ( { listProps } ) => (\n\t\t\t\t\t<TouchableHighlight accessible={ false }>\n\t\t\t\t\t\t{ ! showTabs || filterValue ? (\n\t\t\t\t\t\t\t<InserterSearchResults\n\t\t\t\t\t\t\t\trootClientId={ rootClientId }\n\t\t\t\t\t\t\t\tfilterValue={ filterValue }\n\t\t\t\t\t\t\t\tonSelect={ onSelectItem }\n\t\t\t\t\t\t\t\tlistProps={ listProps }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<InserterTabs\n\t\t\t\t\t\t\t\trootClientId={ rootClientId }\n\t\t\t\t\t\t\t\tlistProps={ listProps }\n\t\t\t\t\t\t\t\ttabIndex={ tabIndex }\n\t\t\t\t\t\t\t\tonSelect={ onSelectItem }\n\t\t\t\t\t\t\t\tshowReusableBlocks={ showReusableBlocks }\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t) }\n\t\t\t\t\t</TouchableHighlight>\n\t\t\t\t) }\n\t\t\t</BottomSheetConsumer>\n\t\t</BottomSheet>\n\t);\n}\n\nexport default InserterMenu;\n"]}