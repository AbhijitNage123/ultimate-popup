{"version":3,"sources":["@wordpress/components/src/input-control/state.js"],"names":["isEmpty","useReducer","initialStateReducer","state","initialInputControlState","_event","error","initialValue","isDirty","isDragEnabled","isDragging","isPressEnterToChange","value","actionTypes","CHANGE","COMMIT","DRAG_END","DRAG_START","DRAG","INVALIDATE","PRESS_DOWN","PRESS_ENTER","PRESS_UP","RESET","UPDATE","inputControlActionTypes","mergeInitialState","initialState","composeStateReducers","fns","args","reduceRight","fn","fnState","inputControlStateReducer","composedStateReducers","action","nextState","type","payload","event","useInputControlStateReducer","stateReducer","dispatch","createChangeEvent","nextValue","persist","createKeyEvent","createDragEvent","dragProps","change","invalidate","reset","commit","update","dragStart","drag","dragEnd","pressUp","pressDown","pressEnter"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { isEmpty } from 'lodash';\n/**\n * WordPress dependencies\n */\nimport { useReducer } from '@wordpress/element';\n\nconst initialStateReducer = ( state ) => state;\n\nconst initialInputControlState = {\n\t_event: {},\n\terror: null,\n\tinitialValue: '',\n\tisDirty: false,\n\tisDragEnabled: false,\n\tisDragging: false,\n\tisPressEnterToChange: false,\n\tvalue: '',\n};\n\nconst actionTypes = {\n\tCHANGE: 'CHANGE',\n\tCOMMIT: 'COMMIT',\n\tDRAG_END: 'DRAG_END',\n\tDRAG_START: 'DRAG_START',\n\tDRAG: 'DRAG',\n\tINVALIDATE: 'INVALIDATE',\n\tPRESS_DOWN: 'PRESS_DOWN',\n\tPRESS_ENTER: 'PRESS_ENTER',\n\tPRESS_UP: 'PRESS_UP',\n\tRESET: 'RESET',\n\tUPDATE: 'UPDATE',\n};\n\nexport const inputControlActionTypes = actionTypes;\n\n/**\n * Prepares initialState for the reducer.\n *\n * @param {Object} initialState The initial state.\n * @return {Object} Prepared initialState for the reducer\n */\nfunction mergeInitialState( initialState = initialInputControlState ) {\n\tconst { value } = initialState;\n\n\treturn {\n\t\t...initialInputControlState,\n\t\t...initialState,\n\t\tinitialValue: value,\n\t};\n}\n\n/**\n * Composes multiple stateReducers into a single stateReducer, building\n * the pipeline to control the flow for state and actions.\n *\n * @param {...Function} fns State reducers.\n * @return {Function} The single composed stateReducer.\n */\nexport const composeStateReducers = ( ...fns ) => {\n\treturn ( ...args ) => {\n\t\treturn fns.reduceRight( ( state, fn ) => {\n\t\t\tconst fnState = fn( ...args );\n\t\t\treturn isEmpty( fnState ) ? state : { ...state, ...fnState };\n\t\t}, {} );\n\t};\n};\n\n/**\n * Creates a reducer that opens the channel for external state subscription\n * and modification.\n *\n * This technique uses the \"stateReducer\" design pattern:\n * https://kentcdodds.com/blog/the-state-reducer-pattern/\n *\n * @param {Function} composedStateReducers A custom reducer that can subscribe and modify state.\n * @return {Function} The reducer.\n */\nfunction inputControlStateReducer( composedStateReducers ) {\n\treturn ( state, action ) => {\n\t\tconst nextState = { ...state };\n\t\tconst { type, payload } = action;\n\n\t\tswitch ( type ) {\n\t\t\t/**\n\t\t\t * Keyboard events\n\t\t\t */\n\t\t\tcase actionTypes.PRESS_UP:\n\t\t\t\tnextState.isDirty = false;\n\t\t\t\tbreak;\n\n\t\t\tcase actionTypes.PRESS_DOWN:\n\t\t\t\tnextState.isDirty = false;\n\t\t\t\tbreak;\n\n\t\t\t/**\n\t\t\t * Drag events\n\t\t\t */\n\t\t\tcase actionTypes.DRAG_START:\n\t\t\t\tnextState.isDragging = true;\n\t\t\t\tbreak;\n\n\t\t\tcase actionTypes.DRAG_END:\n\t\t\t\tnextState.isDragging = false;\n\t\t\t\tbreak;\n\n\t\t\t/**\n\t\t\t * Input events\n\t\t\t */\n\t\t\tcase actionTypes.CHANGE:\n\t\t\t\tnextState.error = null;\n\t\t\t\tnextState.value = payload.value;\n\n\t\t\t\tif ( state.isPressEnterToChange ) {\n\t\t\t\t\tnextState.isDirty = true;\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase actionTypes.COMMIT:\n\t\t\t\tnextState.value = payload.value;\n\t\t\t\tnextState.isDirty = false;\n\t\t\t\tbreak;\n\n\t\t\tcase actionTypes.RESET:\n\t\t\t\tnextState.error = null;\n\t\t\t\tnextState.isDirty = false;\n\t\t\t\tnextState.value = payload.value || state.initialValue;\n\t\t\t\tbreak;\n\n\t\t\tcase actionTypes.UPDATE:\n\t\t\t\tnextState.value = payload.value;\n\t\t\t\tnextState.isDirty = false;\n\t\t\t\tbreak;\n\n\t\t\t/**\n\t\t\t * Validation\n\t\t\t */\n\t\t\tcase actionTypes.INVALIDATE:\n\t\t\t\tnextState.error = payload.error;\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif ( payload.event ) {\n\t\t\tnextState._event = payload.event;\n\t\t}\n\n\t\t/**\n\t\t * Send the nextState + action to the composedReducers via\n\t\t * this \"bridge\" mechanism. This allows external stateReducers\n\t\t * to hook into actions, and modify state if needed.\n\t\t */\n\t\treturn composedStateReducers( nextState, action );\n\t};\n}\n\n/**\n * A custom hook that connects and external stateReducer with an internal\n * reducer. This hook manages the internal state of InputControl.\n * However, by connecting an external stateReducer function, other\n * components can react to actions as well as modify state before it is\n * applied.\n *\n * This technique uses the \"stateReducer\" design pattern:\n * https://kentcdodds.com/blog/the-state-reducer-pattern/\n *\n * @param {Function} stateReducer An external state reducer.\n * @param {Object}   initialState The initial state for the reducer.\n * @return {Object} State, dispatch, and a collection of actions.\n */\nexport function useInputControlStateReducer(\n\tstateReducer = initialStateReducer,\n\tinitialState = initialInputControlState\n) {\n\tconst [ state, dispatch ] = useReducer(\n\t\tinputControlStateReducer( stateReducer ),\n\t\tmergeInitialState( initialState )\n\t);\n\n\tconst createChangeEvent = ( type ) => ( nextValue, event ) => {\n\t\t/**\n\t\t * Persist allows for the (Synthetic) event to be used outside of\n\t\t * this function call.\n\t\t * https://reactjs.org/docs/events.html#event-pooling\n\t\t */\n\t\tif ( event && event.persist ) {\n\t\t\tevent.persist();\n\t\t}\n\n\t\tdispatch( {\n\t\t\ttype,\n\t\t\tpayload: { value: nextValue, event },\n\t\t} );\n\t};\n\n\tconst createKeyEvent = ( type ) => ( event ) => {\n\t\t/**\n\t\t * Persist allows for the (Synthetic) event to be used outside of\n\t\t * this function call.\n\t\t * https://reactjs.org/docs/events.html#event-pooling\n\t\t */\n\t\tif ( event && event.persist ) {\n\t\t\tevent.persist();\n\t\t}\n\n\t\tdispatch( { type, payload: { event } } );\n\t};\n\n\tconst createDragEvent = ( type ) => ( dragProps ) => {\n\t\tdispatch( { type, payload: dragProps } );\n\t};\n\n\t/**\n\t * Actions for the reducer\n\t */\n\tconst change = createChangeEvent( actionTypes.CHANGE );\n\tconst invalidate = createChangeEvent( actionTypes.INVALIDATE );\n\tconst reset = createChangeEvent( actionTypes.RESET );\n\tconst commit = createChangeEvent( actionTypes.COMMIT );\n\tconst update = createChangeEvent( actionTypes.UPDATE );\n\n\tconst dragStart = createDragEvent( actionTypes.DRAG_START );\n\tconst drag = createDragEvent( actionTypes.DRAG );\n\tconst dragEnd = createDragEvent( actionTypes.DRAG_END );\n\n\tconst pressUp = createKeyEvent( actionTypes.PRESS_UP );\n\tconst pressDown = createKeyEvent( actionTypes.PRESS_DOWN );\n\tconst pressEnter = createKeyEvent( actionTypes.PRESS_ENTER );\n\n\treturn {\n\t\tchange,\n\t\tcommit,\n\t\tdispatch,\n\t\tdrag,\n\t\tdragEnd,\n\t\tdragStart,\n\t\tinvalidate,\n\t\tpressDown,\n\t\tpressEnter,\n\t\tpressUp,\n\t\treset,\n\t\tstate,\n\t\tupdate,\n\t};\n}\n"]}