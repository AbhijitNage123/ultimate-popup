{"version":3,"sources":["@wordpress/components/src/slot-fill/bubbles-virtually/slot-fill-provider.js"],"names":["useMemo","useCallback","useState","isShallowEqual","SlotFillContext","useSlotRegistry","slots","setSlots","fills","setFills","registerSlot","name","ref","fillProps","prevSlots","slot","unregisterSlot","nextSlots","updateSlot","slotFills","map","fill","current","rerender","registerFill","prevFills","unregisterFill","filter","fillRef","registry","SlotFillProvider","children"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useMemo, useCallback, useState } from '@wordpress/element';\nimport isShallowEqual from '@wordpress/is-shallow-equal';\n\n/**\n * Internal dependencies\n */\nimport SlotFillContext from './slot-fill-context';\n\nfunction useSlotRegistry() {\n\tconst [ slots, setSlots ] = useState( {} );\n\tconst [ fills, setFills ] = useState( {} );\n\n\tconst registerSlot = useCallback( ( name, ref, fillProps ) => {\n\t\tsetSlots( ( prevSlots ) => {\n\t\t\tconst slot = prevSlots[ name ] || {};\n\t\t\treturn {\n\t\t\t\t...prevSlots,\n\t\t\t\t[ name ]: {\n\t\t\t\t\t...slot,\n\t\t\t\t\tref: ref || slot.ref,\n\t\t\t\t\tfillProps: fillProps || slot.fillProps || {},\n\t\t\t\t},\n\t\t\t};\n\t\t} );\n\t}, [] );\n\n\tconst unregisterSlot = useCallback( ( name, ref ) => {\n\t\tsetSlots( ( prevSlots ) => {\n\t\t\tconst { [ name ]: slot, ...nextSlots } = prevSlots;\n\t\t\t// Make sure we're not unregistering a slot registered by another element\n\t\t\t// See https://github.com/WordPress/gutenberg/pull/19242#issuecomment-590295412\n\t\t\tif ( slot?.ref === ref ) {\n\t\t\t\treturn nextSlots;\n\t\t\t}\n\t\t\treturn prevSlots;\n\t\t} );\n\t}, [] );\n\n\tconst updateSlot = useCallback(\n\t\t( name, fillProps ) => {\n\t\t\tconst slot = slots[ name ];\n\t\t\tif ( ! slot ) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif ( ! isShallowEqual( slot.fillProps, fillProps ) ) {\n\t\t\t\tslot.fillProps = fillProps;\n\t\t\t\tconst slotFills = fills[ name ];\n\t\t\t\tif ( slotFills ) {\n\t\t\t\t\t// Force update fills\n\t\t\t\t\tslotFills.map( ( fill ) => fill.current.rerender() );\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t[ slots, fills ]\n\t);\n\n\tconst registerFill = useCallback( ( name, ref ) => {\n\t\tsetFills( ( prevFills ) => ( {\n\t\t\t...prevFills,\n\t\t\t[ name ]: [ ...( prevFills[ name ] || [] ), ref ],\n\t\t} ) );\n\t}, [] );\n\n\tconst unregisterFill = useCallback( ( name, ref ) => {\n\t\tsetFills( ( prevFills ) => {\n\t\t\tif ( prevFills[ name ] ) {\n\t\t\t\treturn {\n\t\t\t\t\t...prevFills,\n\t\t\t\t\t[ name ]: prevFills[ name ].filter(\n\t\t\t\t\t\t( fillRef ) => fillRef !== ref\n\t\t\t\t\t),\n\t\t\t\t};\n\t\t\t}\n\t\t\treturn prevFills;\n\t\t} );\n\t}, [] );\n\n\t// Memoizing the return value so it can be directly passed to Provider value\n\tconst registry = useMemo(\n\t\t() => ( {\n\t\t\tslots,\n\t\t\tfills,\n\t\t\tregisterSlot,\n\t\t\tupdateSlot,\n\t\t\tunregisterSlot,\n\t\t\tregisterFill,\n\t\t\tunregisterFill,\n\t\t} ),\n\t\t[\n\t\t\tslots,\n\t\t\tfills,\n\t\t\tregisterSlot,\n\t\t\tupdateSlot,\n\t\t\tunregisterSlot,\n\t\t\tregisterFill,\n\t\t\tunregisterFill,\n\t\t]\n\t);\n\n\treturn registry;\n}\n\nexport default function SlotFillProvider( { children } ) {\n\tconst registry = useSlotRegistry();\n\treturn (\n\t\t<SlotFillContext.Provider value={ registry }>\n\t\t\t{ children }\n\t\t</SlotFillContext.Provider>\n\t);\n}\n"]}