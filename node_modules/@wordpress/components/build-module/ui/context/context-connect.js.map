{"version":3,"sources":["@wordpress/components/src/ui/context/context-connect.js"],"names":["uniq","forwardRef","memo","warn","CONNECT_STATIC_NAMESPACE","getStyledClassNameFromKey","contextConnect","Component","namespace","options","memoProp","WrappedComponent","mergedNamespace","Array","isArray","displayName","selector","getConnectNamespace","namespaces","type","hasConnectNamespace","match","includes","some","result"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport { uniq } from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { forwardRef, memo } from '@wordpress/element';\nimport warn from '@wordpress/warning';\n\n/**\n * Internal dependencies\n */\nimport { CONNECT_STATIC_NAMESPACE } from './constants';\nimport { getStyledClassNameFromKey } from './get-styled-class-name-from-key';\n\n/* eslint-disable jsdoc/valid-types */\n/**\n * Forwards ref (React.ForwardRef) and \"Connects\" (or registers) a component\n * within the Context system under a specified namespace.\n *\n * This is an (experimental) evolution of the initial connect() HOC.\n * The hope is that we can improve render performance by removing functional\n * component wrappers.\n *\n * @template {import('./polymorphic-component').PolymorphicComponentProps<{}, any, any>} P\n * @param {(props: P, ref: import('react').Ref<any>) => JSX.Element | null} Component            The component to register into the Context system.\n * @param {string}                                                          namespace            The namespace to register the component under.\n * @param {Object}                                                          options\n * @param {boolean}                                                         [options.memo=false]\n * @return {import('./polymorphic-component').PolymorphicComponentFromProps<P>} The connected PolymorphicComponent\n */\nexport function contextConnect( Component, namespace, options = {} ) {\n\t/* eslint-enable jsdoc/valid-types */\n\tconst { memo: memoProp = false } = options;\n\n\tlet WrappedComponent = forwardRef( Component );\n\tif ( memoProp ) {\n\t\t// @ts-ignore\n\t\tWrappedComponent = memo( WrappedComponent );\n\t}\n\n\tif ( typeof namespace === 'undefined' ) {\n\t\twarn( 'contextConnect: Please provide a namespace' );\n\t}\n\n\t// @ts-ignore internal property\n\tlet mergedNamespace = WrappedComponent[ CONNECT_STATIC_NAMESPACE ] || [\n\t\tnamespace,\n\t];\n\n\t/**\n\t * Consolidate (merge) namespaces before attaching it to the WrappedComponent.\n\t */\n\tif ( Array.isArray( namespace ) ) {\n\t\tmergedNamespace = [ ...mergedNamespace, ...namespace ];\n\t}\n\tif ( typeof namespace === 'string' ) {\n\t\tmergedNamespace = [ ...mergedNamespace, namespace ];\n\t}\n\n\tWrappedComponent.displayName = namespace;\n\n\t// @ts-ignore internal property\n\tWrappedComponent[ CONNECT_STATIC_NAMESPACE ] = uniq( mergedNamespace );\n\n\t// @ts-ignore PolymorphicComponent property\n\tWrappedComponent.selector = `.${ getStyledClassNameFromKey( namespace ) }`;\n\n\t// @ts-ignore\n\treturn WrappedComponent;\n}\n\n/**\n * Attempts to retrieve the connected namespace from a component.\n *\n * @param {import('react').ReactChild | undefined | {}} Component The component to retrieve a namespace from.\n * @return {Array<string>} The connected namespaces.\n */\nexport function getConnectNamespace( Component ) {\n\tif ( ! Component ) return [];\n\n\tlet namespaces = [];\n\n\t// @ts-ignore internal property\n\tif ( Component[ CONNECT_STATIC_NAMESPACE ] ) {\n\t\t// @ts-ignore internal property\n\t\tnamespaces = Component[ CONNECT_STATIC_NAMESPACE ];\n\t}\n\n\t// @ts-ignore\n\tif ( Component.type && Component.type[ CONNECT_STATIC_NAMESPACE ] ) {\n\t\t// @ts-ignore\n\t\tnamespaces = Component.type[ CONNECT_STATIC_NAMESPACE ];\n\t}\n\n\treturn namespaces;\n}\n\n/**\n * Checks to see if a component is connected within the Context system.\n *\n * @param {import('react').ReactNode} Component The component to retrieve a namespace from.\n * @param {Array<string>|string}      match     The namespace to check.\n * @return {boolean} The result.\n */\nexport function hasConnectNamespace( Component, match ) {\n\tif ( ! Component ) return false;\n\n\tif ( typeof match === 'string' ) {\n\t\treturn getConnectNamespace( Component ).includes( match );\n\t}\n\tif ( Array.isArray( match ) ) {\n\t\treturn match.some( ( result ) =>\n\t\t\tgetConnectNamespace( Component ).includes( result )\n\t\t);\n\t}\n\n\treturn false;\n}\n"]}