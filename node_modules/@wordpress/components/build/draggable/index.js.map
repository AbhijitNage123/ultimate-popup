{"version":3,"sources":["@wordpress/components/src/draggable/index.js"],"names":["dragImageClass","cloneWrapperClass","cloneHeightTransformationBreakpoint","clonePadding","bodyClass","Draggable","children","onDragStart","onDragOver","onDragEnd","cloneClassname","elementId","transferData","__experimentalTransferDataType","transferDataType","__experimentalDragComponent","dragComponent","dragComponentRef","cleanup","end","event","preventDefault","current","start","ownerDocument","target","dataTransfer","setData","JSON","stringify","cloneWrapper","createElement","dragImage","setDragImage","classList","add","body","appendChild","style","top","clientY","left","clientX","clonedDragComponent","innerHTML","element","getElementById","elementRect","getBoundingClientRect","elementWrapper","parentNode","elementTopOffset","parseInt","elementLeftOffset","width","clone","cloneNode","id","height","transform","transformOrigin","Array","from","querySelectorAll","forEach","child","removeChild","cursorLeft","cursorTop","over","e","addEventListener","persist","timerId","setTimeout","remove","removeEventListener","clearTimeout","onDraggableStart","onDraggableEnd","display"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useEffect, useRef } from '@wordpress/element';\n\nconst dragImageClass = 'components-draggable__invisible-drag-image';\nconst cloneWrapperClass = 'components-draggable__clone';\nconst cloneHeightTransformationBreakpoint = 700;\nconst clonePadding = 0;\nconst bodyClass = 'is-dragging-components-draggable';\n\n/**\n * @typedef RenderProp\n * @property {(event: import('react').DragEvent) => void} onDraggableStart `onDragStart` handler.\n * @property {(event: import('react').DragEvent) => void} onDraggableEnd   `onDragEnd` handler.\n */\n\n/**\n * @typedef Props\n * @property {(props: RenderProp) => JSX.Element | null}  children                         Children.\n * @property {(event: import('react').DragEvent) => void} [onDragStart]                    Callback when dragging starts.\n * @property {(event: import('react').DragEvent) => void} [onDragOver]                     Callback when dragging happens over the document.\n * @property {(event: import('react').DragEvent) => void} [onDragEnd]                      Callback when dragging ends.\n * @property {string}                                     [cloneClassname]                 Classname for the cloned element.\n * @property {string}                                     [elementId]                      ID for the element.\n * @property {any}                                        [transferData]                   Transfer data for the drag event.\n * @property {string}                                     [__experimentalTransferDataType] The transfer data type to set.\n * @property {import('react').ReactNode}                  __experimentalDragComponent      Component to show when dragging.\n */\n\n/**\n * @param {Props} props\n * @return {JSX.Element} A draggable component.\n */\nexport default function Draggable( {\n\tchildren,\n\tonDragStart,\n\tonDragOver,\n\tonDragEnd,\n\tcloneClassname,\n\telementId,\n\ttransferData,\n\t__experimentalTransferDataType: transferDataType = 'text',\n\t__experimentalDragComponent: dragComponent,\n} ) {\n\t/** @type {import('react').MutableRefObject<HTMLDivElement | null>} */\n\tconst dragComponentRef = useRef( null );\n\tconst cleanup = useRef( () => {} );\n\n\t/**\n\t * Removes the element clone, resets cursor, and removes drag listener.\n\t *\n\t * @param {import('react').DragEvent} event The non-custom DragEvent.\n\t */\n\tfunction end( event ) {\n\t\tevent.preventDefault();\n\t\tcleanup.current();\n\n\t\tif ( onDragEnd ) {\n\t\t\tonDragEnd( event );\n\t\t}\n\t}\n\n\t/**\n\t * This method does a couple of things:\n\t *\n\t * - Clones the current element and spawns clone over original element.\n\t * - Adds a fake temporary drag image to avoid browser defaults.\n\t * - Sets transfer data.\n\t * - Adds dragover listener.\n\t *\n\t * @param {import('react').DragEvent} event The non-custom DragEvent.\n\t */\n\tfunction start( event ) {\n\t\t// @ts-ignore We know that ownerDocument does exist on an Element\n\t\tconst { ownerDocument } = event.target;\n\n\t\tevent.dataTransfer.setData(\n\t\t\ttransferDataType,\n\t\t\tJSON.stringify( transferData )\n\t\t);\n\n\t\tconst cloneWrapper = ownerDocument.createElement( 'div' );\n\t\tconst dragImage = ownerDocument.createElement( 'div' );\n\n\t\t// Set a fake drag image to avoid browser defaults. Remove from DOM\n\t\t// right after. event.dataTransfer.setDragImage is not supported yet in\n\t\t// IE, we need to check for its existence first.\n\t\tif ( 'function' === typeof event.dataTransfer.setDragImage ) {\n\t\t\tdragImage.classList.add( dragImageClass );\n\t\t\townerDocument.body.appendChild( dragImage );\n\t\t\tevent.dataTransfer.setDragImage( dragImage, 0, 0 );\n\t\t}\n\n\t\tcloneWrapper.classList.add( cloneWrapperClass );\n\n\t\tif ( cloneClassname ) {\n\t\t\tcloneWrapper.classList.add( cloneClassname );\n\t\t}\n\n\t\t// If a dragComponent is defined, the following logic will clone the\n\t\t// HTML node and inject it into the cloneWrapper.\n\t\tif ( dragComponentRef.current ) {\n\t\t\t// Position dragComponent at the same position as the cursor.\n\t\t\tcloneWrapper.style.top = `${ event.clientY }px`;\n\t\t\tcloneWrapper.style.left = `${ event.clientX }px`;\n\n\t\t\tconst clonedDragComponent = ownerDocument.createElement( 'div' );\n\t\t\tclonedDragComponent.innerHTML = dragComponentRef.current.innerHTML;\n\t\t\tcloneWrapper.appendChild( clonedDragComponent );\n\n\t\t\t// Inject the cloneWrapper into the DOM.\n\t\t\townerDocument.body.appendChild( cloneWrapper );\n\t\t} else {\n\t\t\tconst element = ownerDocument.getElementById( elementId );\n\n\t\t\t// Prepare element clone and append to element wrapper.\n\t\t\tconst elementRect = element.getBoundingClientRect();\n\t\t\tconst elementWrapper = element.parentNode;\n\t\t\tconst elementTopOffset = parseInt( elementRect.top, 10 );\n\t\t\tconst elementLeftOffset = parseInt( elementRect.left, 10 );\n\n\t\t\tcloneWrapper.style.width = `${\n\t\t\t\telementRect.width + clonePadding * 2\n\t\t\t}px`;\n\n\t\t\tconst clone = element.cloneNode( true );\n\t\t\tclone.id = `clone-${ elementId }`;\n\n\t\t\tif ( elementRect.height > cloneHeightTransformationBreakpoint ) {\n\t\t\t\t// Scale down clone if original element is larger than 700px.\n\t\t\t\tcloneWrapper.style.transform = 'scale(0.5)';\n\t\t\t\tcloneWrapper.style.transformOrigin = 'top left';\n\t\t\t\t// Position clone near the cursor.\n\t\t\t\tcloneWrapper.style.top = `${ event.clientY - 100 }px`;\n\t\t\t\tcloneWrapper.style.left = `${ event.clientX }px`;\n\t\t\t} else {\n\t\t\t\t// Position clone right over the original element (20px padding).\n\t\t\t\tcloneWrapper.style.top = `${\n\t\t\t\t\telementTopOffset - clonePadding\n\t\t\t\t}px`;\n\t\t\t\tcloneWrapper.style.left = `${\n\t\t\t\t\telementLeftOffset - clonePadding\n\t\t\t\t}px`;\n\t\t\t}\n\n\t\t\t// Hack: Remove iFrames as it's causing the embeds drag clone to freeze\n\t\t\tArray.from(\n\t\t\t\tclone.querySelectorAll( 'iframe' )\n\t\t\t).forEach( ( child ) => child.parentNode.removeChild( child ) );\n\n\t\t\tcloneWrapper.appendChild( clone );\n\n\t\t\t// Inject the cloneWrapper into the DOM.\n\t\t\telementWrapper.appendChild( cloneWrapper );\n\t\t}\n\n\t\t// Mark the current cursor coordinates.\n\t\tlet cursorLeft = event.clientX;\n\t\tlet cursorTop = event.clientY;\n\n\t\t/**\n\t\t * @param {import('react').DragEvent} e\n\t\t */\n\t\tfunction over( e ) {\n\t\t\tcloneWrapper.style.top = `${\n\t\t\t\tparseInt( cloneWrapper.style.top, 10 ) + e.clientY - cursorTop\n\t\t\t}px`;\n\t\t\tcloneWrapper.style.left = `${\n\t\t\t\tparseInt( cloneWrapper.style.left, 10 ) + e.clientX - cursorLeft\n\t\t\t}px`;\n\n\t\t\t// Update cursor coordinates.\n\t\t\tcursorLeft = e.clientX;\n\t\t\tcursorTop = e.clientY;\n\n\t\t\tif ( onDragOver ) {\n\t\t\t\tonDragOver( e );\n\t\t\t}\n\t\t}\n\n\t\townerDocument.addEventListener( 'dragover', over );\n\n\t\t// Update cursor to 'grabbing', document wide.\n\t\townerDocument.body.classList.add( bodyClass );\n\n\t\t// Allow the Synthetic Event to be accessed from asynchronous code.\n\t\t// https://reactjs.org/docs/events.html#event-pooling\n\t\tevent.persist();\n\n\t\t/** @type {number | undefined} */\n\t\tlet timerId;\n\n\t\tif ( onDragStart ) {\n\t\t\ttimerId = setTimeout( () => onDragStart( event ) );\n\t\t}\n\n\t\tcleanup.current = () => {\n\t\t\t// Remove drag clone\n\t\t\tif ( cloneWrapper && cloneWrapper.parentNode ) {\n\t\t\t\tcloneWrapper.parentNode.removeChild( cloneWrapper );\n\t\t\t}\n\n\t\t\tif ( dragImage && dragImage.parentNode ) {\n\t\t\t\tdragImage.parentNode.removeChild( dragImage );\n\t\t\t}\n\n\t\t\t// Reset cursor.\n\t\t\townerDocument.body.classList.remove( bodyClass );\n\n\t\t\townerDocument.removeEventListener( 'dragover', over );\n\n\t\t\tclearTimeout( timerId );\n\t\t};\n\t}\n\n\tuseEffect(\n\t\t() => () => {\n\t\t\tcleanup.current();\n\t\t},\n\t\t[]\n\t);\n\n\treturn (\n\t\t<>\n\t\t\t{ children( {\n\t\t\t\tonDraggableStart: start,\n\t\t\t\tonDraggableEnd: end,\n\t\t\t} ) }\n\t\t\t{ dragComponent && (\n\t\t\t\t<div\n\t\t\t\t\tclassName=\"components-draggable-drag-component-root\"\n\t\t\t\t\tstyle={ { display: 'none' } }\n\t\t\t\t\tref={ dragComponentRef }\n\t\t\t\t>\n\t\t\t\t\t{ dragComponent }\n\t\t\t\t</div>\n\t\t\t) }\n\t\t</>\n\t);\n}\n"]}