{"version":3,"sources":["@wordpress/blocks/src/store/reducer.js"],"names":["filter","find","get","isEmpty","keyBy","map","mapValues","omit","uniqBy","combineReducers","__","DEFAULT_CATEGORIES","slug","title","blockTypes","state","action","type","blockType","names","blockStyles","name","style","blockName","styles","styleNames","indexOf","blockVariations","variation","variations","variationNames","createBlockNameSetterReducer","setActionType","defaultBlockName","freeformFallbackBlockName","unregisteredFallbackBlockName","groupingBlockName","categories","category","categoryToChange","collections","namespace","icon"],"mappings":"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","sourcesContent":["/**\n * External dependencies\n */\nimport {\n\tfilter,\n\tfind,\n\tget,\n\tisEmpty,\n\tkeyBy,\n\tmap,\n\tmapValues,\n\tomit,\n\tuniqBy,\n} from 'lodash';\n\n/**\n * WordPress dependencies\n */\nimport { combineReducers } from '@wordpress/data';\nimport { __ } from '@wordpress/i18n';\n\n/**\n * @typedef {Object} WPBlockCategory\n *\n * @property {string} slug  Unique category slug.\n * @property {string} title Category label, for display in user interface.\n */\n\n/**\n * Default set of categories.\n *\n * @type {WPBlockCategory[]}\n */\nexport const DEFAULT_CATEGORIES = [\n\t{ slug: 'text', title: __( 'Text' ) },\n\t{ slug: 'media', title: __( 'Media' ) },\n\t{ slug: 'design', title: __( 'Design' ) },\n\t{ slug: 'widgets', title: __( 'Widgets' ) },\n\t{ slug: 'theme', title: __( 'Theme' ) },\n\t{ slug: 'embed', title: __( 'Embeds' ) },\n\t{ slug: 'reusable', title: __( 'Reusable blocks' ) },\n];\n\n/**\n * Reducer managing the block types\n *\n * @param {Object} state  Current state.\n * @param {Object} action Dispatched action.\n *\n * @return {Object} Updated state.\n */\nexport function blockTypes( state = {}, action ) {\n\tswitch ( action.type ) {\n\t\tcase 'ADD_BLOCK_TYPES':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\t...keyBy(\n\t\t\t\t\tmap( action.blockTypes, ( blockType ) =>\n\t\t\t\t\t\tomit( blockType, 'styles ' )\n\t\t\t\t\t),\n\t\t\t\t\t'name'\n\t\t\t\t),\n\t\t\t};\n\t\tcase 'REMOVE_BLOCK_TYPES':\n\t\t\treturn omit( state, action.names );\n\t}\n\n\treturn state;\n}\n\n/**\n * Reducer managing the block style variations.\n *\n * @param {Object} state  Current state.\n * @param {Object} action Dispatched action.\n *\n * @return {Object} Updated state.\n */\nexport function blockStyles( state = {}, action ) {\n\tswitch ( action.type ) {\n\t\tcase 'ADD_BLOCK_TYPES':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\t...mapValues(\n\t\t\t\t\tkeyBy( action.blockTypes, 'name' ),\n\t\t\t\t\t( blockType ) => {\n\t\t\t\t\t\treturn uniqBy(\n\t\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\t...get( blockType, [ 'styles' ], [] ),\n\t\t\t\t\t\t\t\t...get( state, [ blockType.name ], [] ),\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t( style ) => style.name\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t),\n\t\t\t};\n\t\tcase 'ADD_BLOCK_STYLES':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\t[ action.blockName ]: uniqBy(\n\t\t\t\t\t[\n\t\t\t\t\t\t...get( state, [ action.blockName ], [] ),\n\t\t\t\t\t\t...action.styles,\n\t\t\t\t\t],\n\t\t\t\t\t( style ) => style.name\n\t\t\t\t),\n\t\t\t};\n\t\tcase 'REMOVE_BLOCK_STYLES':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\t[ action.blockName ]: filter(\n\t\t\t\t\tget( state, [ action.blockName ], [] ),\n\t\t\t\t\t( style ) => action.styleNames.indexOf( style.name ) === -1\n\t\t\t\t),\n\t\t\t};\n\t}\n\n\treturn state;\n}\n\n/**\n * Reducer managing the block variations.\n *\n * @param {Object} state  Current state.\n * @param {Object} action Dispatched action.\n *\n * @return {Object} Updated state.\n */\nexport function blockVariations( state = {}, action ) {\n\tswitch ( action.type ) {\n\t\tcase 'ADD_BLOCK_TYPES':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\t...mapValues(\n\t\t\t\t\tkeyBy( action.blockTypes, 'name' ),\n\t\t\t\t\t( blockType ) => {\n\t\t\t\t\t\treturn uniqBy(\n\t\t\t\t\t\t\t[\n\t\t\t\t\t\t\t\t...get( blockType, [ 'variations' ], [] ),\n\t\t\t\t\t\t\t\t...get( state, [ blockType.name ], [] ),\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t( variation ) => variation.name\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t),\n\t\t\t};\n\t\tcase 'ADD_BLOCK_VARIATIONS':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\t[ action.blockName ]: uniqBy(\n\t\t\t\t\t[\n\t\t\t\t\t\t...get( state, [ action.blockName ], [] ),\n\t\t\t\t\t\t...action.variations,\n\t\t\t\t\t],\n\t\t\t\t\t( variation ) => variation.name\n\t\t\t\t),\n\t\t\t};\n\t\tcase 'REMOVE_BLOCK_VARIATIONS':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\t[ action.blockName ]: filter(\n\t\t\t\t\tget( state, [ action.blockName ], [] ),\n\t\t\t\t\t( variation ) =>\n\t\t\t\t\t\taction.variationNames.indexOf( variation.name ) === -1\n\t\t\t\t),\n\t\t\t};\n\t}\n\n\treturn state;\n}\n\n/**\n * Higher-order Reducer creating a reducer keeping track of given block name.\n *\n * @param {string} setActionType Action type.\n *\n * @return {Function} Reducer.\n */\nexport function createBlockNameSetterReducer( setActionType ) {\n\treturn ( state = null, action ) => {\n\t\tswitch ( action.type ) {\n\t\t\tcase 'REMOVE_BLOCK_TYPES':\n\t\t\t\tif ( action.names.indexOf( state ) !== -1 ) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t\treturn state;\n\n\t\t\tcase setActionType:\n\t\t\t\treturn action.name || null;\n\t\t}\n\n\t\treturn state;\n\t};\n}\n\nexport const defaultBlockName = createBlockNameSetterReducer(\n\t'SET_DEFAULT_BLOCK_NAME'\n);\nexport const freeformFallbackBlockName = createBlockNameSetterReducer(\n\t'SET_FREEFORM_FALLBACK_BLOCK_NAME'\n);\nexport const unregisteredFallbackBlockName = createBlockNameSetterReducer(\n\t'SET_UNREGISTERED_FALLBACK_BLOCK_NAME'\n);\nexport const groupingBlockName = createBlockNameSetterReducer(\n\t'SET_GROUPING_BLOCK_NAME'\n);\n\n/**\n * Reducer managing the categories\n *\n * @param {WPBlockCategory[]} state  Current state.\n * @param {Object}            action Dispatched action.\n *\n * @return {WPBlockCategory[]} Updated state.\n */\nexport function categories( state = DEFAULT_CATEGORIES, action ) {\n\tswitch ( action.type ) {\n\t\tcase 'SET_CATEGORIES':\n\t\t\treturn action.categories || [];\n\t\tcase 'UPDATE_CATEGORY': {\n\t\t\tif ( ! action.category || isEmpty( action.category ) ) {\n\t\t\t\treturn state;\n\t\t\t}\n\t\t\tconst categoryToChange = find( state, [ 'slug', action.slug ] );\n\t\t\tif ( categoryToChange ) {\n\t\t\t\treturn map( state, ( category ) => {\n\t\t\t\t\tif ( category.slug === action.slug ) {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t...category,\n\t\t\t\t\t\t\t...action.category,\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\treturn category;\n\t\t\t\t} );\n\t\t\t}\n\t\t}\n\t}\n\treturn state;\n}\n\nexport function collections( state = {}, action ) {\n\tswitch ( action.type ) {\n\t\tcase 'ADD_BLOCK_COLLECTION':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\t[ action.namespace ]: {\n\t\t\t\t\ttitle: action.title,\n\t\t\t\t\ticon: action.icon,\n\t\t\t\t},\n\t\t\t};\n\t\tcase 'REMOVE_BLOCK_COLLECTION':\n\t\t\treturn omit( state, action.namespace );\n\t}\n\treturn state;\n}\n\nexport default combineReducers( {\n\tblockTypes,\n\tblockStyles,\n\tblockVariations,\n\tdefaultBlockName,\n\tfreeformFallbackBlockName,\n\tunregisteredFallbackBlockName,\n\tgroupingBlockName,\n\tcategories,\n\tcollections,\n} );\n"]}