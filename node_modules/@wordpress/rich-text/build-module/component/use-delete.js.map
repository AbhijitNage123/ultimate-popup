{"version":3,"sources":["@wordpress/rich-text/src/component/use-delete.js"],"names":["useRef","useRefEffect","BACKSPACE","DELETE","remove","removeLineSeparator","isEmptyLine","useDelete","props","propsRef","current","element","onKeyDown","event","keyCode","createRecord","handleChange","multilineTag","defaultPrevented","currentValue","start","end","text","isReverse","length","preventDefault","newValue","addEventListener","removeEventListener"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,MAAT,QAAuB,oBAAvB;AACA,SAASC,YAAT,QAA6B,oBAA7B;AACA,SAASC,SAAT,EAAoBC,MAApB,QAAkC,qBAAlC;AAEA;AACA;AACA;;AACA,SAASC,MAAT,QAAuB,WAAvB;AACA,SAASC,mBAAT,QAAoC,0BAApC;AACA,SAASC,WAAT,QAA4B,aAA5B;AAEA,OAAO,SAASC,SAAT,CAAoBC,KAApB,EAA4B;AAClC,QAAMC,QAAQ,GAAGT,MAAM,CAAEQ,KAAF,CAAvB;AACAC,EAAAA,QAAQ,CAACC,OAAT,GAAmBF,KAAnB;AACA,SAAOP,YAAY,CAAIU,OAAF,IAAe;AACnC,aAASC,SAAT,CAAoBC,KAApB,EAA4B;AAC3B,YAAM;AAAEC,QAAAA;AAAF,UAAcD,KAApB;AACA,YAAM;AACLE,QAAAA,YADK;AAELC,QAAAA,YAFK;AAGLC,QAAAA;AAHK,UAIFR,QAAQ,CAACC,OAJb;;AAMA,UAAKG,KAAK,CAACK,gBAAX,EAA8B;AAC7B;AACA;;AAED,UAAKJ,OAAO,KAAKX,MAAZ,IAAsBW,OAAO,KAAKZ,SAAvC,EAAmD;AAClD;AACA;;AAED,YAAMiB,YAAY,GAAGJ,YAAY,EAAjC;AACA,YAAM;AAAEK,QAAAA,KAAF;AAASC,QAAAA,GAAT;AAAcC,QAAAA;AAAd,UAAuBH,YAA7B;AACA,YAAMI,SAAS,GAAGT,OAAO,KAAKZ,SAA9B,CAlB2B,CAoB3B;;AACA,UAAKkB,KAAK,KAAK,CAAV,IAAeC,GAAG,KAAK,CAAvB,IAA4BA,GAAG,KAAKC,IAAI,CAACE,MAA9C,EAAuD;AACtDR,QAAAA,YAAY,CAAEZ,MAAM,CAAEe,YAAF,CAAR,CAAZ;AACAN,QAAAA,KAAK,CAACY,cAAN;AACA;AACA;;AAED,UAAKR,YAAL,EAAoB;AACnB,YAAIS,QAAJ,CADmB,CAGnB;;AACA,YACCH,SAAS,IACTJ,YAAY,CAACC,KAAb,KAAuB,CADvB,IAEAD,YAAY,CAACE,GAAb,KAAqB,CAFrB,IAGAf,WAAW,CAAEa,YAAF,CAJZ,EAKE;AACDO,UAAAA,QAAQ,GAAGrB,mBAAmB,CAAEc,YAAF,EAAgB,CAAEI,SAAlB,CAA9B;AACA,SAPD,MAOO;AACNG,UAAAA,QAAQ,GAAGrB,mBAAmB,CAAEc,YAAF,EAAgBI,SAAhB,CAA9B;AACA;;AAED,YAAKG,QAAL,EAAgB;AACfV,UAAAA,YAAY,CAAEU,QAAF,CAAZ;AACAb,UAAAA,KAAK,CAACY,cAAN;AACA;AACD;AACD;;AAEDd,IAAAA,OAAO,CAACgB,gBAAR,CAA0B,SAA1B,EAAqCf,SAArC;AACA,WAAO,MAAM;AACZD,MAAAA,OAAO,CAACiB,mBAAR,CAA6B,SAA7B,EAAwChB,SAAxC;AACA,KAFD;AAGA,GAtDkB,EAsDhB,EAtDgB,CAAnB;AAuDA","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useRef } from '@wordpress/element';\nimport { useRefEffect } from '@wordpress/compose';\nimport { BACKSPACE, DELETE } from '@wordpress/keycodes';\n\n/**\n * Internal dependencies\n */\nimport { remove } from '../remove';\nimport { removeLineSeparator } from '../remove-line-separator';\nimport { isEmptyLine } from '../is-empty';\n\nexport function useDelete( props ) {\n\tconst propsRef = useRef( props );\n\tpropsRef.current = props;\n\treturn useRefEffect( ( element ) => {\n\t\tfunction onKeyDown( event ) {\n\t\t\tconst { keyCode } = event;\n\t\t\tconst {\n\t\t\t\tcreateRecord,\n\t\t\t\thandleChange,\n\t\t\t\tmultilineTag,\n\t\t\t} = propsRef.current;\n\n\t\t\tif ( event.defaultPrevented ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ( keyCode !== DELETE && keyCode !== BACKSPACE ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst currentValue = createRecord();\n\t\t\tconst { start, end, text } = currentValue;\n\t\t\tconst isReverse = keyCode === BACKSPACE;\n\n\t\t\t// Always handle full content deletion ourselves.\n\t\t\tif ( start === 0 && end !== 0 && end === text.length ) {\n\t\t\t\thandleChange( remove( currentValue ) );\n\t\t\t\tevent.preventDefault();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ( multilineTag ) {\n\t\t\t\tlet newValue;\n\n\t\t\t\t// Check to see if we should remove the first item if empty.\n\t\t\t\tif (\n\t\t\t\t\tisReverse &&\n\t\t\t\t\tcurrentValue.start === 0 &&\n\t\t\t\t\tcurrentValue.end === 0 &&\n\t\t\t\t\tisEmptyLine( currentValue )\n\t\t\t\t) {\n\t\t\t\t\tnewValue = removeLineSeparator( currentValue, ! isReverse );\n\t\t\t\t} else {\n\t\t\t\t\tnewValue = removeLineSeparator( currentValue, isReverse );\n\t\t\t\t}\n\n\t\t\t\tif ( newValue ) {\n\t\t\t\t\thandleChange( newValue );\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\telement.addEventListener( 'keydown', onKeyDown );\n\t\treturn () => {\n\t\t\telement.removeEventListener( 'keydown', onKeyDown );\n\t\t};\n\t}, [] );\n}\n"]}