{"version":3,"sources":["@wordpress/rich-text/src/replace.js"],"names":["replace","formats","replacements","text","start","end","pattern","replacement","match","rest","offset","length","newText","newFormats","newReplacements","Array","fill","slice","concat"],"mappings":";;;;;;;AAIA;;AAJA;AACA;AACA;;AAIA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAASA,OAAT,CACN;AAAEC,EAAAA,OAAF;AAAWC,EAAAA,YAAX;AAAyBC,EAAAA,IAAzB;AAA+BC,EAAAA,KAA/B;AAAsCC,EAAAA;AAAtC,CADM,EAENC,OAFM,EAGNC,WAHM,EAIL;AACDJ,EAAAA,IAAI,GAAGA,IAAI,CAACH,OAAL,CAAcM,OAAd,EAAuB,CAAEE,KAAF,EAAS,GAAGC,IAAZ,KAAsB;AACnD,UAAMC,MAAM,GAAGD,IAAI,CAAEA,IAAI,CAACE,MAAL,GAAc,CAAhB,CAAnB;AACA,QAAIC,OAAO,GAAGL,WAAd;AACA,QAAIM,UAAJ;AACA,QAAIC,eAAJ;;AAEA,QAAK,OAAOF,OAAP,KAAmB,UAAxB,EAAqC;AACpCA,MAAAA,OAAO,GAAGL,WAAW,CAAEC,KAAF,EAAS,GAAGC,IAAZ,CAArB;AACA;;AAED,QAAK,OAAOG,OAAP,KAAmB,QAAxB,EAAmC;AAClCC,MAAAA,UAAU,GAAGD,OAAO,CAACX,OAArB;AACAa,MAAAA,eAAe,GAAGF,OAAO,CAACV,YAA1B;AACAU,MAAAA,OAAO,GAAGA,OAAO,CAACT,IAAlB;AACA,KAJD,MAIO;AACNU,MAAAA,UAAU,GAAGE,KAAK,CAAEH,OAAO,CAACD,MAAV,CAAlB;AACAG,MAAAA,eAAe,GAAGC,KAAK,CAAEH,OAAO,CAACD,MAAV,CAAvB;;AAEA,UAAKV,OAAO,CAAES,MAAF,CAAZ,EAAyB;AACxBG,QAAAA,UAAU,GAAGA,UAAU,CAACG,IAAX,CAAiBf,OAAO,CAAES,MAAF,CAAxB,CAAb;AACA;AACD;;AAEDT,IAAAA,OAAO,GAAGA,OAAO,CACfgB,KADQ,CACD,CADC,EACEP,MADF,EAERQ,MAFQ,CAEAL,UAFA,EAEYZ,OAAO,CAACgB,KAAR,CAAeP,MAAM,GAAGF,KAAK,CAACG,MAA9B,CAFZ,CAAV;AAGAT,IAAAA,YAAY,GAAGA,YAAY,CACzBe,KADa,CACN,CADM,EACHP,MADG,EAEbQ,MAFa,CAGbJ,eAHa,EAIbZ,YAAY,CAACe,KAAb,CAAoBP,MAAM,GAAGF,KAAK,CAACG,MAAnC,CAJa,CAAf;;AAOA,QAAKP,KAAL,EAAa;AACZA,MAAAA,KAAK,GAAGC,GAAG,GAAGK,MAAM,GAAGE,OAAO,CAACD,MAA/B;AACA;;AAED,WAAOC,OAAP;AACA,GAtCM,CAAP;AAwCA,SAAO,wCAAkB;AAAEX,IAAAA,OAAF;AAAWC,IAAAA,YAAX;AAAyBC,IAAAA,IAAzB;AAA+BC,IAAAA,KAA/B;AAAsCC,IAAAA;AAAtC,GAAlB,CAAP;AACA","sourcesContent":["/**\n * Internal dependencies\n */\n\nimport { normaliseFormats } from './normalise-formats';\n\n/** @typedef {import('./create').RichTextValue} RichTextValue */\n\n/**\n * Search a Rich Text value and replace the match(es) with `replacement`. This\n * is similar to `String.prototype.replace`.\n *\n * @param {RichTextValue}   value       The value to modify.\n * @param {RegExp|string}   pattern     A RegExp object or literal. Can also be\n *                                      a string. It is treated as a verbatim\n *                                      string and is not interpreted as a\n *                                      regular expression. Only the first\n *                                      occurrence will be replaced.\n * @param {Function|string} replacement The match or matches are replaced with\n *                                      the specified or the value returned by\n *                                      the specified function.\n *\n * @return {RichTextValue} A new value with replacements applied.\n */\nexport function replace(\n\t{ formats, replacements, text, start, end },\n\tpattern,\n\treplacement\n) {\n\ttext = text.replace( pattern, ( match, ...rest ) => {\n\t\tconst offset = rest[ rest.length - 2 ];\n\t\tlet newText = replacement;\n\t\tlet newFormats;\n\t\tlet newReplacements;\n\n\t\tif ( typeof newText === 'function' ) {\n\t\t\tnewText = replacement( match, ...rest );\n\t\t}\n\n\t\tif ( typeof newText === 'object' ) {\n\t\t\tnewFormats = newText.formats;\n\t\t\tnewReplacements = newText.replacements;\n\t\t\tnewText = newText.text;\n\t\t} else {\n\t\t\tnewFormats = Array( newText.length );\n\t\t\tnewReplacements = Array( newText.length );\n\n\t\t\tif ( formats[ offset ] ) {\n\t\t\t\tnewFormats = newFormats.fill( formats[ offset ] );\n\t\t\t}\n\t\t}\n\n\t\tformats = formats\n\t\t\t.slice( 0, offset )\n\t\t\t.concat( newFormats, formats.slice( offset + match.length ) );\n\t\treplacements = replacements\n\t\t\t.slice( 0, offset )\n\t\t\t.concat(\n\t\t\t\tnewReplacements,\n\t\t\t\treplacements.slice( offset + match.length )\n\t\t\t);\n\n\t\tif ( start ) {\n\t\t\tstart = end = offset + newText.length;\n\t\t}\n\n\t\treturn newText;\n\t} );\n\n\treturn normaliseFormats( { formats, replacements, text, start, end } );\n}\n"]}